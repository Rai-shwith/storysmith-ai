{% extends 'main/base.html' %}

{% block title %}Your Story - StorySmith AI{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-lg-10">
        <!-- Header Card -->
        <div class="card mb-4">
            <div class="card-header text-center">
                <h2 class="mb-0">üé≠ Your Generated Story</h2>
                <p class="mb-0 mt-2 opacity-75">Here's your personalized story created by AI</p>
                {% if detected_style %}
                <div class="mt-2">
                    <span class="badge badge-info">Style: {{ detected_style|title }}</span>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Original Input Display -->
        <div class="card mb-4 result-card">
            <div class="card-body">
                <h5 class="card-title">üìù Your Original Prompt</h5>
                <div class="alert alert-light border">
                    <strong>Text Prompt:</strong> {{ text_prompt }}
                </div>
                {% if audio_filename %}
                <div class="alert alert-info border">
                    <strong>Audio File:</strong> {{ audio_filename }}
                    <small class="text-muted d-block">Audio was received and will be processed for future integration</small>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Generated Content Section -->
        <div class="row">
            <!-- Story Text -->
            <div class="col-lg-6 mb-4">
                <div class="card result-card h-100">
                    <div class="card-header">
                        <h5 class="mb-0">üìö Generated Story</h5>
                    </div>
                    <div class="card-body">
                        {% if story_text %}
                        <div class="story-content">
                            {{ story_text|linebreaks }}
                        </div>
                        {% else %}
                        <div class="placeholder-content">
                            <p class="text-muted">Story content will appear here once generation is complete.</p>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Character Description -->
            <div class="col-lg-6 mb-4">
                <div class="card result-card h-100">
                    <div class="card-header">
                        <h5 class="mb-0">üë• Character Description</h5>
                    </div>
                    <div class="card-body">
                        {% if character_description %}
                        <div class="character-content">
                            {{ character_description|linebreaks }}
                        </div>
                        {% else %}
                        <div class="placeholder-content">
                            <p class="text-muted">Character description will appear here once generation is complete.</p>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        {% if background_description %}
        <!-- Background Description Section -->
        <div class="card mb-4 result-card">
            <div class="card-header">
                <h5 class="mb-0">üèûÔ∏è Background Setting</h5>
            </div>
            <div class="card-body">
                <div class="background-content">
                    {{ background_description|linebreaks }}
                </div>
            </div>
        </div>
        {% endif %}

        <!-- Image Gallery Section -->
        <div class="row mb-4">
            <!-- Final Merged Image -->
            {% if final_image_url %}
            <div class="col-lg-12 mb-4">
                <div class="card result-card">
                    <div class="card-header">
                        <h5 class="mb-0">üé® Complete Story Visualization</h5>
                    </div>
                    <div class="card-body text-center">
                        <img src="{{ MEDIA_URL }}{{ final_image_url }}" alt="Complete Story Scene" class="img-fluid rounded shadow">
                        <p class="mt-2 text-muted">Character and background merged together</p>
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- Individual Images -->
            <div class="col-lg-6 mb-4">
                <div class="card result-card h-100">
                    <div class="card-header">
                        <h5 class="mb-0">üë§ Character Image</h5>
                    </div>
                    <div class="card-body text-center">
                        {% if character_image_url %}
                            <img src="{{ MEDIA_URL }}{{ character_image_url }}" alt="Generated Character" class="img-fluid rounded shadow">
                        {% else %}
                            <div class="placeholder-content">
                                <h6>üé≠ Character Image</h6>
                                <p class="text-muted">The AI-generated character image will appear here.</p>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <div class="col-lg-6 mb-4">
                <div class="card result-card h-100">
                    <div class="card-header">
                        <h5 class="mb-0">üèûÔ∏è Background Image</h5>
                    </div>
                    <div class="card-body text-center">
                        {% if background_image_url %}
                            <img src="{{ MEDIA_URL }}{{ background_image_url }}" alt="Generated Background" class="img-fluid rounded shadow">
                        {% else %}
                            <div class="placeholder-content">
                                <h6>üñºÔ∏è Background Image</h6>
                                <p class="text-muted">The AI-generated background image will appear here.</p>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="text-center mb-4">
            {% if retry_url %}
            <a href="{{ retry_url }}" class="btn btn-warning btn-lg me-3">
                <i class="fas fa-redo"></i> Try Again with Changes
            </a>
            {% endif %}
            <a href="{% url 'home' %}" class="btn btn-primary btn-lg me-3">
                ‚ú® Create Another Story
            </a>
        </div>

        <!-- Development Status -->
        <div class="card border-warning">
            <div class="card-body">
                <h6 class="card-title text-warning">üöß Development Status</h6>
                <div class="row">
                    <div class="col-md-4">
                        <div class="alert alert-success">
                            <strong>‚úÖ Completed:</strong>
                            <ul class="mb-0 mt-2">
                                <li>Django Frontend</li>
                                <li>Form Handling</li>
                                <li>Audio Upload</li>
                                <li>File Management</li>
                            </ul>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="alert alert-warning">
                            <strong>üîÑ In Progress:</strong>
                            <ul class="mb-0 mt-2">
                                <li>LangChain Integration</li>
                                <li>Audio to Text Conversion</li>
                                <li>Story Generation</li>
                            </ul>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="alert alert-info">
                            <strong>üìã Planned:</strong>
                            <ul class="mb-0 mt-2">
                                <li>Image Generation</li>
                                <li>Advanced Styling</li>
                                <li>Export Options</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
    @media print {
        .navbar, .card-header, .btn, .alert-warning, .alert-info, footer {
            display: none !important;
        }
        
        .card {
            border: none !important;
            box-shadow: none !important;
        }
        
        .placeholder-content {
            background: none !important;
            animation: none !important;
            color: black !important;
        }
    }
</style>
{% endblock %}
